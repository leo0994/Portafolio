---
import Badge from "../components/Badge.astro";
import Layout from "../layouts/Layout.astro";
import "../styles/global.css";
import "../styles/layout.css";
import LinkedinInIcon from "../icons/linkedin.astro";
import GithubInIcon from "../icons/github.astro";
import FileCVico from "../icons/filecvico.astro";
import Briefcase from "../icons/briefcase.astro";
import Emailico from "../icons/emailico.astro";
import Experience from "../components/Experience.astro";
import Proyectos from "../components/Proyectos.astro";
import Contacto from "../components/Contacto.astro";
import DevLogoAnimado from "../icons/devlogoanimado.astro";
import SocialPill from "../components/SocialPill.astro";
import SectionContainer from "../components/SectionContainer.astro";
---

<Layout description="Portafolio leo Dev - Desarrollador y Programador Web.">
  <main>
    <SectionContainer id="inicio" class="pt-32 py-16 pb-96">
      <div
        class="flex flex-col items-center gap-y-6 text-center max-w-4xl mx-auto"
      >
        <!-- Título principal -->
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold">
          <span id="main-title" class="main-title text-white">
            <span class="text-gray-300">Hola, Soy </span>
            <span
              id="name-text"
              class="bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent"
              >Leo Barrantes</span
            >
          </span>
        </h1>

        <!-- Soy + Typed.js -->
        <div class="typed-wrapper w-full flex justify-center mt-4">
          <h2
            class="text-2xl sm:text-3xl lg:text-4xl font-semibold no-scramble typed-line"
          >
            <span class="text-gray-300 mr-2">Soy</span>
            <span
              id="typed-text"
              class="text-blue-400 no-scramble typed-text-content"></span>
          </h2>
        </div>

        <style>
          /* Wrapper principal */
          .typed-wrapper {
            min-height: 4rem;
            display: flex;
            align-items: center;
          }

          /* Línea del typed */
          .typed-line {
            position: relative;
            display: inline-flex;
            align-items: baseline;
            white-space: nowrap;
          }

          /* Contenedor del texto con ancho fijo */
          .typed-text-content {
            display: inline-block;
            min-width: 500px;
            text-align: left;
            position: relative;
            vertical-align: baseline;
          }

          @media (max-width: 640px) {
            .typed-text-content {
              min-width: 320px;
            }
          }

          /* Ocultar TODOS los cursores generados por Typed.js - más agresivo */
          .typed-cursor,
          .typed-cursor--blink,
          .typed-line .typed-cursor,
          .typed-text-content .typed-cursor,
          #typed-text .typed-cursor,
          span[class*="typed-cursor"] {
            position: absolute;
            left: -9999px;
            width: 0;
            height: 0;
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
            display: none;
            visibility: hidden;
          }

          /* Cursor personalizado con pseudo-elemento */
          .typed-text-content::after {
            content: "|";
            color: rgb(96, 165, 250);
            display: inline-block;
            animation: cursor-blink 0.8s step-end infinite;
            margin-left: 3px;
            font-weight: 600;
          }

          @keyframes cursor-blink {
            0%,
            50% {
              opacity: 1;
            }
            50.01%,
            100% {
              opacity: 0;
            }
          }
        </style>

        <!-- Descripción -->
        <p
          data-i18n="descripcion_principal"
          class="text-gray-400 text-lg sm:text-xl leading-relaxed"
        >
          3+ años de experiencia. De San José, Costa Rica.
        </p>

        <!-- Badge -->
        <Badge
          class="text-xs sm:text-sm bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-4 py-2 rounded-full shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 transition-all duration-300 hover:scale-105"
          data-i18n="disponible"
        >
          ✨ Disponible para trabajar
        </Badge>
      </div>

      <div
        class="flex items-center justify-center gap-3 gap-y-3 mt-8 flex-wrap max-w-2xl mx-auto"
      >
        <SocialPill href="https://www.linkedin.com/in/leo-barrantes-928aa122a">
          <LinkedinInIcon class="w-6 h-6" />
          <span data-i18n="linkedin">LinkedIn</span>
        </SocialPill>

        <SocialPill href="https://github.com/leo0994">
          <GithubInIcon class="w-6 h-6" />
          <span data-i18n="github">Github</span>
        </SocialPill>

        <SocialPill
          href="/Portafolio/cv/leobarrantescv_english.pdf"
          target="_blank"
        >
          <FileCVico class="w-6 h-6" />
          <span data-i18n="ingles">Inglés</span>
        </SocialPill>

        <SocialPill
          href="/Portafolio/cv/leobarrantescv_español.pdf"
          target="_blank"
        >
          <FileCVico class="w-6 h-6" />
          <span data-i18n="espanol">Español</span>
        </SocialPill>
      </div>
    </SectionContainer>

    <SectionContainer
      id="experiencia"
      class="py-24 pb-40"
      style="scroll-margin-top: 0px;"
    >
      <div class="flex justify-center sm:justify-start items-center mb-8 gap-4">
        <img
          src="/Portafolio/icons/LogoPlasmaCeleste.png"
          alt="Logo animado"
          class="w-10 h-10 sm:w-12 sm:h-12 animate-spin-slow hover:scale-110 transition duration-300"
        />
        <h2
          class="text-[rgb(240,240,240)] text-2xl sm:text-3xl lg:text-4xl font-semibold"
        >
          <span data-i18n="experiencia_laboral">Experiencia laboral</span>
        </h2>
      </div>
      <Experience />
    </SectionContainer>

    <Proyectos />
    <Contacto />
  </main>
</Layout>

<script is:inline>
  // @ts-nocheck
  // Efecto líquido en hover sobre el nombre
  const nameText = document.getElementById("name-text");

  if (nameText) {
    nameText.addEventListener("mouseenter", () => {
      nameText.classList.add("liquid-text");
    });

    nameText.addEventListener("mouseleave", () => {
      nameText.classList.remove("liquid-text");
    });
  }
</script>

<script is:inline>
  // @ts-nocheck
  // Typed.js para el efecto de escritura - ejecutar después de que todo esté cargado
  (function () {
    let attempts = 0;
    const maxAttempts = 50;
    let typedInstance = null;

    function initTyped() {
      attempts++;
      const typedElement = document.getElementById("typed-text");

      if (!typedElement) {
        if (attempts < maxAttempts) {
          setTimeout(initTyped, 100);
        }
        return;
      }

      if (typeof Typed === "undefined") {
        if (attempts < maxAttempts) {
          setTimeout(initTyped, 100);
        }
        return;
      }

      // Destruir instancia previa si existe
      if (typedInstance) {
        typedInstance.destroy();
      }

      // Limpiar cualquier cursor residual
      const existingCursors = document.querySelectorAll(".typed-cursor");
      existingCursors.forEach((cursor) => cursor.remove());

      console.log("✅ Inicializando Typed.js");

      try {
        typedInstance = new Typed("#typed-text", {
          strings: [
            "Desarrollador Web",
            "Desarrollador Frontend",
            "Desarrollador Backend",
            "Desarrollador Full Stack",
            "Ingeniero de Software",
            "Entusiasta de la Tecnología",
            "Creador de Experiencias Digitales",
            "Solucionador de Problemas",
          ],
          typeSpeed: 100,
          backSpeed: 60,
          backDelay: 3000,
          startDelay: 1200,
          loop: true,
          showCursor: false,
          cursorChar: "",
          attr: null,
          contentType: "text",
          smartBackspace: true,
          fadeOut: false,
          shuffle: false,
          onStringTyped: function (arrayPos, self) {
            // Remover cualquier cursor al terminar de escribir
            setTimeout(() => {
              const cursors = document.querySelectorAll(".typed-cursor");
              cursors.forEach((c) => c.remove());
            }, 50);
          },
          onBegin: function (self) {
            // Remover cursors al comenzar
            const cursors = document.querySelectorAll(".typed-cursor");
            cursors.forEach((c) => c.remove());
          },
        });

        // Forzar remoción de cursor después de inicializar
        setTimeout(() => {
          const cursors = document.querySelectorAll(".typed-cursor");
          cursors.forEach((c) => c.remove());
        }, 100);

        console.log("✅ Typed.js inicializado correctamente");
      } catch (error) {
        console.error("❌ Error al inicializar Typed.js:", error);
      }
    }

    // Esperar a que el loading screen termine
    window.addEventListener("loadingComplete", () => {
      setTimeout(initTyped, 100);
    });

    // Fallback por si el evento no se dispara
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", () => {
        setTimeout(initTyped, 1200);
      });
    } else {
      setTimeout(initTyped, 1200);
    }
  })();
</script>
